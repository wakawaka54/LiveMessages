
@{
    ViewBag.Title = "Admin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Admin</h2>
<div class="admin-chat">

</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            var userName = "Admin";

            // Create a function that the hub can call back to display messages.
            chat.client.addAdminMessage = function (id, name, message) {
                var chatElement = $("[data-chat-id='" + id + "']");
                if (chatElement.length == 0)
                {
                    chatElement = createChatContainer(id);
                }

                // Add the message to the page.
                $('#discussion', chatElement).append('<li><strong>' + htmlEncode(name)
                    + '</strong>: ' + htmlEncode(message) + '</li>');
            };

            chat.client.confirmDelivery = function (messageID) {

            };
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {

            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }

        function onSendClick(event) {
            var id = event.currentTarget.attributes["data-chat-id"].value;
            var message = $('#message, ' +  "[data-chat-id='" + id + "']").val();

            //Set message id unconfirmed
            ids.push(latestMessageID);
            // Call the Send method on the hub.
            chat.server.send(userName, $('#message').val(), latestMessageID);
            // Clear text box and reset focus for next comment.
            $('#message').val('').focus();

            $('#discussion').append('<li class="chat-unsent" data-messageID="' + latestMessageID + '"><strong>' + userName + '</strong>' + message + '</li>');
        }

        function createChatContainer(id) {
            $(".admin-chat").append('<div class="admin-chat--chatbox" data-chat-id="' + id + '"></div>');
            var chatElement = $("[data-chat-id='" + id + "']");

            var domElements = '<input type="checkbox"/>ID<br/><ul id="discussion"></ul><input type="text" id="message" data-chat-id="ID" /><input type="button" id="sendmessage" value="Send" data-chat-id="ID" />';
            domElements = domElements.replace(/ID/g, id);

            chatElement.append(domElements);

            $('#sendmessage', chatElement).click(onSendClick);
        }
    </script>

}